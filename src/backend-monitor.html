<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kerala Travel Tracker - Backend Monitor</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: linear-gradient(135deg, #f0f9f0 0%, #e8f5e8 100%);
            min-height: 100vh;
        }
        .header {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
            background: white;
            border-radius: 15px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        .header h1 {
            color: #059669;
            margin: 0;
            font-size: 2rem;
        }
        .subtitle {
            color: #6b7280;
            margin: 5px 0 0 0;
        }
        .endpoint-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        .endpoint-card {
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            border-left: 4px solid #059669;
        }
        .endpoint-method {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 0.8rem;
            font-weight: bold;
            margin-bottom: 10px;
        }
        .method-get { background: #dbeafe; color: #1e40af; }
        .method-post { background: #dcfce7; color: #166534; }
        .method-put { background: #fef3c7; color: #92400e; }
        .method-delete { background: #fee2e2; color: #dc2626; }
        .endpoint-url {
            font-family: 'Monaco', 'Menlo', monospace;
            background: #f9fafb;
            padding: 8px;
            border-radius: 6px;
            font-size: 0.9rem;
            word-break: break-all;
            margin: 10px 0;
        }
        .test-button {
            background: #059669;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.9rem;
            margin-top: 10px;
        }
        .test-button:hover {
            background: #047857;
        }
        .test-button:disabled {
            background: #9ca3af;
            cursor: not-allowed;
        }
        .response-area {
            background: #f3f4f6;
            border: 1px solid #d1d5db;
            border-radius: 6px;
            padding: 10px;
            margin-top: 10px;
            font-family: 'Monaco', 'Menlo', monospace;
            font-size: 0.8rem;
            max-height: 200px;
            overflow-y: auto;
            display: none;
        }
        .status-indicator {
            display: inline-block;
            width: 10px;
            height: 10px;
            border-radius: 50%;
            margin-right: 8px;
        }
        .status-healthy { background: #10b981; }
        .status-error { background: #ef4444; }
        .status-unknown { background: #6b7280; }
        .info-section {
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            margin-top: 20px;
        }
        .demo-credentials {
            background: #eff6ff;
            border: 1px solid #3b82f6;
            border-radius: 8px;
            padding: 15px;
            margin: 15px 0;
        }
        .demo-credentials h4 {
            color: #1e40af;
            margin: 0 0 10px 0;
        }
        .credential-item {
            font-family: 'Monaco', 'Menlo', monospace;
            background: #f8fafc;
            padding: 5px 8px;
            border-radius: 4px;
            margin: 5px 0;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>ðŸŒ´ Kerala Travel Tracker</h1>
        <p class="subtitle">Backend API Monitor & Testing Dashboard</p>
        <div>
            <span id="backend-status" class="status-indicator status-unknown"></span>
            <span>Backend Status: <span id="status-text">Checking...</span></span>
        </div>
    </div>

    <div class="demo-credentials">
        <h4>ðŸŽ¯ Real Authentication Required</h4>
        <p style="margin: 10px 0 0 0; font-size: 0.9rem; color: #6b7280;">
            Create a real account to test the full app experience with personal Kerala trips.
        </p>
    </div>

    <div class="endpoint-grid">
        <!-- Health Check -->
        <div class="endpoint-card">
            <div class="endpoint-method method-get">GET</div>
            <h3>Health Check</h3>
            <p>Check if the backend server is running and healthy.</p>
            <div class="endpoint-url">/health</div>
            <button class="test-button" onclick="testEndpoint('/health', 'GET')">Test Health</button>
            <div class="response-area" id="response-health"></div>
        </div>

        <!-- User Registration -->
        <div class="endpoint-card">
            <div class="endpoint-method method-post">POST</div>
            <h3>User Registration</h3>
            <p>Create a new user account with email, password, and name.</p>
            <div class="endpoint-url">/auth/signup</div>
            <button class="test-button" onclick="testSignup()">Test Signup</button>
            <div class="response-area" id="response-signup"></div>
        </div>

        <!-- Password Reset -->
        <div class="endpoint-card">
            <div class="endpoint-method method-post">POST</div>
            <h3>Password Reset</h3>
            <p>Send password reset email to user.</p>
            <div class="endpoint-url">/auth/reset-password</div>
            <button class="test-button" onclick="testPasswordReset()">Test Reset</button>
            <div class="response-area" id="response-reset"></div>
        </div>

        <!-- Get User Profile -->
        <div class="endpoint-card">
            <div class="endpoint-method method-get">GET</div>
            <h3>Get User Profile</h3>
            <p>Retrieve user profile information (requires authentication).</p>
            <div class="endpoint-url">/user/profile</div>
            <button class="test-button" onclick="testEndpoint('/user/profile', 'GET', true)">Test Profile</button>
            <div class="response-area" id="response-profile"></div>
        </div>

        <!-- Get Trips -->
        <div class="endpoint-card">
            <div class="endpoint-method method-get">GET</div>
            <h3>Get User Trips</h3>
            <p>Retrieve all trips for authenticated user.</p>
            <div class="endpoint-url">/trips</div>
            <button class="test-button" onclick="testEndpoint('/trips', 'GET', true)">Test Get Trips</button>
            <div class="response-area" id="response-trips"></div>
        </div>

        <!-- Save Trip -->
        <div class="endpoint-card">
            <div class="endpoint-method method-post">POST</div>
            <h3>Save New Trip</h3>
            <p>Save a new Kerala trip (requires authentication).</p>
            <div class="endpoint-url">/trips</div>
            <button class="test-button" onclick="testSaveTrip()">Test Save Trip</button>
            <div class="response-area" id="response-save-trip"></div>
        </div>
    </div>

    <div class="info-section">
        <h3>ðŸ”— Backend Information</h3>
        <p><strong>Base URL:</strong> <span class="endpoint-url">https://dubyklstpzpuvjdfztsa.supabase.co/functions/v1/make-server-561789f4</span></p>
        <p><strong>Technology:</strong> Supabase Edge Functions + Hono Web Framework</p>
        <p><strong>Database:</strong> PostgreSQL with KV Store abstraction</p>
        <p><strong>Authentication:</strong> Supabase Auth with JWT tokens</p>
        
        <h4>ðŸŽ¯ Features Available:</h4>
        <ul>
            <li>Real user authentication and session management</li>
            <li>Trip data persistence and retrieval</li>
            <li>User profile management</li>
            <li>Password reset functionality</li>
            <li>Demo mode with sample data</li>
        </ul>
    </div>

    <script>
        const BASE_URL = 'https://dubyklstpzpuvjdfztsa.supabase.co/functions/v1/make-server-561789f4';
        const ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImR1YnlrbHN0cHpwdXZqZGZ6dHNhIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTg4Njc2NjAsImV4cCI6MjA3NDQ0MzY2MH0.bJpGzkJ1v_vdNWYxRlbn_gYECduJuTOs_AxlfV4ozCI';

        async function testEndpoint(endpoint, method = 'GET', requiresAuth = false, body = null) {
            const responseId = 'response-' + endpoint.replace(/\//g, '').replace(/:/g, '-');
            const responseArea = document.getElementById(responseId);
            
            if (!responseArea) {
                // Try alternative IDs for specific endpoints
                const altIds = {
                    '/health': 'response-health',
                    '/user/profile': 'response-profile',
                    '/trips': 'response-trips'
                };
                const altResponseArea = document.getElementById(altIds[endpoint]);
                if (altResponseArea) {
                    showResponse(altResponseArea, 'Testing...', false);
                }
            } else {
                showResponse(responseArea, 'Testing...', false);
            }

            const headers = {
                'Content-Type': 'application/json',
                'Authorization': `Bearer ${ANON_KEY}`
            };

            const config = {
                method,
                headers
            };

            if (body) {
                config.body = JSON.stringify(body);
            }

            try {
                const response = await fetch(BASE_URL + endpoint, config);
                const data = await response.json();
                
                const result = {
                    status: response.status,
                    statusText: response.statusText,
                    data: data
                };

                const targetArea = responseArea || document.getElementById(altIds[endpoint]);
                if (targetArea) {
                    showResponse(targetArea, JSON.stringify(result, null, 2), response.ok);
                }

                // Update overall status if this is the health check
                if (endpoint === '/health' && response.ok) {
                    updateBackendStatus(true);
                }

            } catch (error) {
                const errorResult = {
                    error: error.message,
                    type: 'Network Error'
                };
                
                const targetArea = responseArea || document.getElementById(altIds[endpoint]);
                if (targetArea) {
                    showResponse(targetArea, JSON.stringify(errorResult, null, 2), false);
                }

                if (endpoint === '/health') {
                    updateBackendStatus(false);
                }
            }
        }

        function showResponse(element, content, isSuccess) {
            element.style.display = 'block';
            element.style.color = isSuccess ? '#065f46' : '#dc2626';
            element.style.background = isSuccess ? '#f0fdf4' : '#fef2f2';
            element.textContent = content;
        }

        function updateBackendStatus(isHealthy) {
            const indicator = document.getElementById('backend-status');
            const text = document.getElementById('status-text');
            
            if (isHealthy) {
                indicator.className = 'status-indicator status-healthy';
                text.textContent = 'Healthy';
            } else {
                indicator.className = 'status-indicator status-error';
                text.textContent = 'Error';
            }
        }

        function testSignup() {
            const testUser = {
                email: `test-${Date.now()}@kerala.com`,
                password: 'test123',
                name: 'Test User'
            };
            testEndpoint('/auth/signup', 'POST', false, testUser);
        }

        function testPasswordReset() {
            const resetData = {
                email: 'test@kerala.com'
            };
            testEndpoint('/auth/reset-password', 'POST', false, resetData);
        }

        function testSaveTrip() {
            const tripData = {
                origin: 'Kochi',
                destination: 'Alappuzha',
                date: new Date().toISOString().split('T')[0],
                mode: 'boat',
                distance: '53 km',
                carbonFootprint: '4.2 kg',
                status: 'planned'
            };
            testEndpoint('/trips', 'POST', true, tripData);
        }

        // Auto-test health on page load
        window.addEventListener('load', () => {
            setTimeout(() => {
                testEndpoint('/health');
            }, 1000);
        });
    </script>
</body>
</html>